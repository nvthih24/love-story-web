<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Playfair+Display:ital,wght@1,600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    </link>
</head>

<body>
    <div class="bokeh"></div>
    <div class="bokeh"></div>
    <div class="bokeh"></div>
    <div id="character-container">
        <video id="character" muted loop>
            <source src="nhanvat_noi.mp4" type="video/mp4">
            Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ th·∫ª video.
        </video>
    </div>

    <div id="dialogue-box">
        <div id="text"></div>
        <div class="controls">
            <button id="btn-next">Ti·∫øp t·ª•c</button>
            <button id="btn-decline">T·ª´ ch·ªëi</button>
            <button id="btn-accept">ƒê·ªìng √Ω</button>
        </div>
    </div>

    <script>
        function createFloatingHeart() {
            const heart = document.createElement('div');
            heart.className = 'floating-heart';
            heart.innerHTML = '‚ù§';

            // V·ªã tr√≠ ngang ng·∫´u nhi√™n
            heart.style.left = Math.random() * 100 + 'vw';

            // K√≠ch th∆∞·ªõc ng·∫´u nhi√™n (t·∫°o chi·ªÅu s√¢u)
            const size = Math.random() * 15 + 10 + 'px';
            heart.style.fontSize = size;

            // Th·ªùi gian bay v√† ƒë·ªô m·ªù ng·∫´u nhi√™n
            const duration = Math.random() * 5 + 10 + 's';
            heart.style.animationDuration = duration;
            heart.style.opacity = Math.random() * 0.4 + 0.2;

            document.body.appendChild(heart);

            // X√≥a ƒë·ªÉ tr√°nh lag m√°y
            setTimeout(() => {
                heart.remove();
            }, parseFloat(duration) * 1000);
        }
        // Gi·ªØ nguy√™n Logic c≈© c·ªßa b·∫°n
        const dialogues = [
            "Xin ch√†o em! Ng∆∞·ªùi con g√°i t√¥i th∆∞∆°ng, ng√†y h√¥m nay c·ªßa em th·∫ø n√†o? C√≥ vui kh√¥ng, c√≥ bu·ªìn kh√¥ng? Anh th√¨ ƒëang r·∫•t h·ªìi h·ªôp v√† h·∫°nh ph√∫c. V√¨ sao ∆∞? V√¨‚Ä¶",
            // "Ban ƒë·∫ßu anh c≈©ng ng·∫°i tr√≤ chuy·ªán v·ªõi ng∆∞·ªùi l·∫°, nma th·∫•y em h√≤a ƒë·ªìng t∆∞∆°ng t√°c v·ªõi anh c≈©ng nh∆∞ m·ªçi ng∆∞·ªùi, anh th·∫ßm nghƒ©: ‚Äú B√© n√†y n√≥i chuy·ªán d·ªÖ th∆∞∆°ng v·∫≠y ta hay l√† tr√™u x√≠u nh·ªâ ‚Äú. Em c√≥ nh·ªõ l·∫ßn ƒë·∫ßu ti√™n 2 ta nh·∫Øn tin kh√¥ng, anh b·ªã ng∆∞·ªùi ƒë·∫πp s·∫•y v√¨ tag em mi·∫øt ·∫•y, l√∫c ƒë√≥ anh c≈©ng ·∫•y n·∫•y d·ªØ l·∫Øm, ki·ªÉu n√†y h∆°i b·ªã ham vui qu√° haha. Sau ƒë√≥ l√† m·ªôt v√†i ch·ªß ƒë·ªÅ n√≥i chuy·ªán v·ªõi nhau, nh·ªØng c√¢u b√¥ng ƒë√πa nh·ªØng l·∫ßn chia s·∫Ω k·ªâ ni·ªám, r·ªìi d·∫ßn d·∫ßn‚Ä¶",
            // "Anh nh·∫≠n ra ƒë√¢y kh√¥ng ch·ªâ l√† t√¨nh c·∫£m b·∫°n b√® th√¥ng th∆∞·ªùng n·ªØa. M·ªói l·∫ßn tr√≤ chuy·ªán v·ªõi em m√† m·ªói l·∫ßn anh c·∫£m th·∫•y long ng·ª±c m√¨nh n√≥ r·ªôn r√†ng, l√¢u l·∫Øm r·ªìi anh ch∆∞a ch·ªù ƒë·ª£i, tr√¥ng ng√≥ng tin nh·∫Øn c·ªßa m·ªôt ai ƒë·∫øn v·∫≠y. Nh·ªØng l·∫ßn t√¢m s·ª±, nh·ªØng th·ª© t∆∞·ªüng ch·ª´ng nh∆∞ nh·ªè nh·∫∑t m√† n√≥ mang l·∫°i cho anh m·ªôt c·∫£m x√∫c h·∫°nh ph√∫c kh√≥ t·∫£.",
            // "V√† r·ªìi 1 ng√†y ƒë·∫ßu nƒÉm tuy·ªát v·ªùi, chuy·ªán g√¨ ƒë·∫øn n√≥ c≈©ng ƒë·∫øn. Tr∆∞·ªõc ƒë√™m ƒë√≥ anh ƒë√£ u·ªëng th·∫≠t say r·ªìi suy nghƒ© th·∫≠t kƒ© ‚Äú Kh√¥ng! Kh√¥ng th·ªÉ ch·ªù ƒë∆∞·ª£c n·ªØa! Ng√†y mai ngay khi t·ªânh gi·∫•c m√¨nh ph·∫£i n√≥i ‚Äú. Th·∫ø l√† s√°ng h√¥m sau anh l·∫•y d≈©ng kh√≠ ƒë·ªÉ l√°i c√¢u chuy·ªán v√†o h∆∞·ªõng ƒë·ªÉ anh t·ªè t√¨nh. Anh d·ª± l√† 1 l·ªùi t·ªè t√¨nh ch√≠nh th·ª©c  m√† sao n√≥ h∆°i v√≤ng vo 1 t√≠ d√π sao th√¨ v·∫´n ƒë·∫°t ƒë∆∞·ª£c m·ª•c ƒë√≠ch ban ƒë·∫ßu. L√∫c ƒë·∫ßu th·∫•y em suy nghƒ© h∆°i l√¢u v√† ki·ªÉu nh∆∞ mu·ªën t·ª´ ch·ªëi ·∫•y anh s·∫Øp suy s·ª•p ƒë·∫øn n∆°i r·ªìi nh∆∞ng m√† anh ƒë√£ nh·∫©y c·∫≥ng l√™n khi em n√≥i cho anh c∆° h·ªôi ƒë·ªÉ t√¨m hi·ªÉu anh th·∫≠t s·ª± th·∫≠t s·ª± h·∫°nh ph√∫c.",
            // "T·ª´ ƒë√≥ ƒë·∫øn nay c≈©ng ƒë√£ tr√≤n 1 th√°ng hai ta ch√≠nh th·ª©c t√¨m hi·ªÉu. Tr√£i qua c≈©ng ƒë·ªß lo·∫°i c·∫£m x√∫c r·ªìi, vui c√≥, bu·ªìn c√≥, gi·∫≠n c√≥, kh√≥ ch·ªãu c√≥, bu·ªìn c√≥, h·∫°nh ph√∫c c√≥. Anh xin ph√©p ƒë∆∞·ª£c n√≥i l·ªùi c·∫£m ∆°n v√† xin l·ªói ƒë·∫øn em. Anh c·∫£m ∆°n v√¨ em ƒë√£ ƒë·∫øn b√™n anh v√† ch·ªâ d·∫°y anh c√°ch ƒë·ªÉ y√™u l·∫•y m·ªôt ng∆∞·ªùi, d·∫°y anh tr∆∞·ªüng th√†nh, d·∫°y anh bi·∫øt ƒë√¢u l√† nh∆∞·ªùng nh·ªãn, d·∫°y anh h√£y t·∫≠p trung v√†o hi·ªán t·∫°i ƒë·ª´ng lo l·∫Øng v√†o t∆∞∆°ng lai xa v√¨ t∆∞∆°ng lai ƒë√≥ l√† do ch√≠nh tay 2 ta t·∫°o n√™n. Anh xin l·ªói v√¨ nh·ªØng l·∫ßn m·∫Øc l·ªói khi·∫øn em c·∫£m th·∫•y t·ªßi than, nh·ªØng l·∫ßn ham ch∆°i b·ªè b√™ em m·ªôt m√¨nh, nh·ªØng l·∫ßn ƒë·ªÉ c·∫£m x√∫c l·∫•n √°c t√¢m tr√≠ khi·∫øn em c·∫£m gi√°c kh√¥ng an t√¢m khi ·ªü b√™n anh. M·ªôt l·∫ßn n·ªØa anh mu·ªën c·∫£m ∆°n em v√¨ ƒë√£ th·∫•u hi·∫øu, tha th·ª© cho s·ª± tr·∫ª con c·ªßa anh, c·∫£m ∆°n em v√¨ ƒë√£ cho anh c∆° h·ªôi ƒë·ªÉ d·ªó d√†nh em, c·∫£m ∆°n em v√¨ t·∫•t c·∫£. Anh y√™u em ‚ù§ !",
            "D√†i d√≤ng c≈©ng ƒë·ªß r·ªìi, h√¥m nay c≈©ng l√† ng√†y tr√≤n 1 th√°ng anh ƒë∆∞·ª£c ph√©p t√¨m hi·ªÉu V√¢n, anh ch·ªâ mu·ªën n√≥i l√† ‚Äú Anh Y√™u Em ‚ù§ ! Em c√≥ th·ªÉ cho anh m·ªôt c∆° h·ªôi ƒë·ªÉ c√πng em s√°nh b∆∞·ªõc, c√πng em tr√£i qua v√¥ v√†ng c·∫£m x√∫c, c√πng nhau ti·∫øn v·ªÅ t∆∞∆°ng lai m√† ·ªü ƒë√≥ anh v√† em c√πng n·∫Øm tay nhau, c√πng nhau tr√≤ chuy·ªán, c√πng nhau t√¢m s·ª±, c√πng c∆∞·ªùi n√≥i, c√πng bu·ªìn kh√≥c , n√≥i chung l√† anh mu·ªën ƒë∆∞·ª£c tr√£i qua m·ªçi th·ª© c√πng em. C√≥ ƒë∆∞·ª£c kh√¥ng em?‚Äù"
        ];

        let currentStep = 0;
        const textElement = document.getElementById('text');
        const character = document.getElementById('character');
        const btnNext = document.getElementById('btn-next');
        const btnAccept = document.getElementById('btn-accept');
        const btnDecline = document.getElementById('btn-decline');
        const typeSound = new Audio('path/to/type-sound.mp3'); // Ti·∫øng t√≠c t√≠c ng·∫Øn
        const bgm = new Audio('path/to/background-music.mp3');
        bgm.loop = true;
        const characterContainer = document.getElementById('character-container');
        const dialogueBox = document.getElementById('dialogue-box');
        const heartContainer = document.getElementById('heart-container');

        function typeWriter(text, index = 0) {
            if (index === 0) {
                textElement.innerHTML = "";
                character.play();
                hideButtons();
                bgm.play().catch(e => console.log("C·∫ßn t∆∞∆°ng t√°c ƒë·ªÉ ph√°t nh·∫°c"));
            }

            if (index < text.length) {
                textElement.innerHTML += text.charAt(index);
                // Ph√°t ti·∫øng g√µ ch·ªØ (t√πy ch·ªçn)
                if (typeSound.paused) {
                    typeSound.currentTime = 0;
                    typeSound.play();
                }
                setTimeout(() => typeWriter(text, index + 1), 30);
            } else {
                character.pause(); // D·ª´ng video khi ch·ªØ ch·∫°y xong
                character.currentTime = 0; // Quay v·ªÅ frame ƒë·∫ßu ti√™n c·ªßa video (mi·ªáng ƒë√≥ng)
                showButtons();
            }
        }

        function hideButtons() {
            btnNext.style.display = 'none';
            btnAccept.style.display = 'none';
            btnDecline.style.display = 'none';
        }

        function showButtons() {
            if (currentStep < dialogues.length - 1) {
                btnNext.style.display = 'block';
            } else {
                btnAccept.style.display = 'block';
                btnDecline.style.display = 'block';
            }
        }

        btnNext.addEventListener('click', () => {
            currentStep++;
            typeWriter(dialogues[currentStep]);
        });

        window.onload = () => {
            typeWriter(dialogues[currentStep]);
            setInterval(createFloatingHeart, 500);
        };

        btnAccept.addEventListener('click', () => {

            const audio = document.getElementById('bg-music');
            audio.play().catch(error => {
                console.log("L·ªói autoplay (n·∫øu c√≥):", error);
            });
            // ·∫®n giao di·ªán c≈©
            document.getElementById('character-container').style.display = 'none';
            document.getElementById('dialogue-box').style.display = 'none';

            // Hi·ªán khung ch·ª©a tr√°i tim
            const heartWrapper = document.getElementById('heart-wrapper');
            heartWrapper.style.display = 'block';

            // N·∫°p l·∫ßn l∆∞·ª£t c√°c file JS c·ªßa hi·ªáu ·ª©ng tr√°i tim
            // L∆∞u √Ω: Ph·∫£i n·∫°p ƒë√∫ng th·ª© t·ª±
            loadScript('js/universe.js') // Hi·ªáu ·ª©ng sao
                .then(() => loadScript('js/particle.js')) // Hi·ªáu ·ª©ng tr√°i tim ch√≠nh
                .then(() => loadScript('js/main.js')) // Hi·ªáu ·ª©ng h·∫°t bay th√™m
                .then(() => {
                    console.log("Heart animation loaded!");
                    // N·∫øu mu·ªën th√™m nh·∫°c th√¨ play ·ªü ƒë√¢y
                    // var audio = new Audio('renxi.mp3'); audio.play();
                })
                .catch(err => console.error("L·ªói n·∫°p script:", err));
        });
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.body.appendChild(script);
            });
        }

        function moveButton() {
            // 1. L·∫•y k√≠ch th∆∞·ªõc m√†n h√¨nh hi·ªán t·∫°i
            // D√πng document.documentElement.clientWidth ƒë·ªÉ tr·ª´ ƒëi thanh cu·ªôn (n·∫øu c√≥)
            const screenWidth = window.innerWidth || document.documentElement.clientWidth;
            const screenHeight = window.innerHeight || document.documentElement.clientHeight;

            // 2. L·∫•y k√≠ch th∆∞·ªõc c·ªßa n√∫t
            const btnWidth = 1329;
            const btnHeight = 957;

            // 3. Thi·∫øt l·∫≠p v√πng an to√†n (Margin)
            const margin = 50; // C√°ch m√©p m√†n h√¨nh √≠t nh·∫•t 50px

            // 4. T√≠nh to√°n t·ªça ƒë·ªô t·ªëi ƒëa cho ph√©p (Max X, Max Y)
            // T·ªça ƒë·ªô n√†y l√† ƒëi·ªÉm b·∫Øt ƒë·∫ßu c·ªßa n√∫t (g√≥c tr√™n-tr√°i n√∫t)
            // N√™n ph·∫£i tr·ª´ ƒëi k√≠ch th∆∞·ªõc n√∫t v√† margin
            const maxX = screenWidth - btnWidth - margin;
            const maxY = screenHeight - btnHeight - margin;

            // 5. Sinh t·ªça ƒë·ªô ng·∫´u nhi√™n nh∆∞ng C√ì GI·ªöI H·∫†N (Clamping)
            // C√¥ng th·ª©c: Random t·ª´ [margin] ƒë·∫øn [maxX]
            const randomX = margin + Math.random() * (maxX - margin);
            const randomY = margin + Math.random() * (maxY - margin);

            // 6. √Åp d·ª•ng v·ªã tr√≠
            btnDecline.style.position = 'fixed'; // Quan tr·ªçng: fixed gi√∫p tho√°t kh·ªèi h·ªôp tho·∫°i
            btnDecline.style.left = `${randomX}px`;
            btnDecline.style.top = `${randomY}px`;

            // Th√™m hi·ªáu ·ª©ng l∆∞·ªõt nhanh ƒë·ªÉ kh√≥ b·∫Øt h∆°n (0.1s)
            btnDecline.style.transition = 'left 0.1s ease, top 0.1s ease';
        }

        // K√≠ch ho·∫°t khi di chu·ªôt qua (D√†nh cho m√°y t√≠nh)
        btnDecline.addEventListener('mouseover', moveButton);

        // K√≠ch ho·∫°t khi ch·∫°m v√†o (D√†nh cho ƒëi·ªán tho·∫°i)
        btnDecline.addEventListener('touchstart', (e) => {
            e.preventDefault(); // NgƒÉn ch·∫∑n h√†nh ƒë·ªông click m·∫∑c ƒë·ªãnh khi ch·∫°m
            moveButton();
        });
        btnDecline.addEventListener('click', () => {
            // 1. D·ª´ng nh·∫°c n·ªÅn vui (n·∫øu c√≥)
            // bgm.pause();

            // 2. ·∫®n to√†n b·ªô giao di·ªán hi·ªán t·∫°i
            document.getElementById('character-container').style.display = 'none';
            document.getElementById('dialogue-box').style.display = 'none';
            document.getElementById('heart-wrapper').style.display = 'none'; // ƒê·ªÅ ph√≤ng

            // 3. T·∫°o m√†n h√¨nh k·∫øt th√∫c bu·ªìn
            const sadScreen = document.createElement('div');
            sadScreen.style.position = 'fixed';
            sadScreen.style.top = '0';
            sadScreen.style.left = '0';
            sadScreen.style.width = '100%';
            sadScreen.style.height = '100%';
            sadScreen.style.backgroundColor = '#000';
            sadScreen.style.color = '#fff';
            sadScreen.style.display = 'flex';
            sadScreen.style.justifyContent = 'center';
            sadScreen.style.alignItems = 'center';
            sadScreen.style.fontSize = '30px';
            sadScreen.style.flexDirection = 'column';
            sadScreen.style.zIndex = '9999';

            // Hi·ªáu ·ª©ng ch·ªØ m·ªù d·∫ßn hi·ªán ra
            sadScreen.innerHTML = `
        <div style="opacity: 0; transition: opacity 3s;" id="sad-text">
            üíî Ti·∫øc qu√°, h·∫πn g·∫∑p l·∫°i b·∫°n l·∫ßn sau...
        </div>
    `;

            document.body.appendChild(sadScreen);

            // K√≠ch ho·∫°t hi·ªáu ·ª©ng hi·ªán ch·ªØ sau 100ms
            setTimeout(() => {
                document.getElementById('sad-text').style.opacity = '1';
            }, 100);
        });
    </script>
    <div id="heart-wrapper">
        <canvas id="universe"></canvas>

        <canvas id="pinkboard"></canvas>

        <div id="corners-container">
            <div class="corner top-left">
                <div class="music-control" onclick="toggleMusic()">
                    <div class="vinyl-record" id="record-spin">üéµ</div>
                    <div class="song-info">
                        <span id="song-name">ƒêang ph√°t: Love Song</span>
                        <span id="music-status">Click ƒë·ªÉ b·∫≠t nh·∫°c</span>
                    </div>
                </div>
            </div>
            <div class="corner top-right">
                <div class="love-timer">
                    <span>B√™n nhau ƒë∆∞·ª£c:</span>
                    <div id="timer-display">00 : 00 : 00</div>
                </div>
            </div>
            <div class="corner bottom-left">
                <div class=" quote">
                    "Y√™u kh√¥ng ph·∫£i l√† nh√¨n nhau, m√† l√† c√πng nh√¨n v·ªÅ m·ªôt h∆∞·ªõng." - Antoine de Saint-Exup√©ry
                </div>
            </div>
            <div class="corner bottom-right">
                <a href="https://m.me/hoang.khang.544656" target="_blank" class="msg-btn">
                    üíå G·ª≠i l·ªùi nh·∫Øn
                </a>
            </div>
        </div>
        <audio id="bg-music" loop>
            <source src="Swim.mp3" type="audio/mp3">
            Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ th·∫ª audio.
        </audio>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

</body>

</html>