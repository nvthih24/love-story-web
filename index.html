<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;300;400;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">

    </link>
</head>

<div id="heart-container">
    <div class="css-heart"></div>
</div>

<body>

    <div id="character-container">
        <video id="character" muted loop>
            <source src="nhanvat_noi.mp4" type="video/mp4">
            Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ th·∫ª video.
        </video>
    </div>

    <div id="dialogue-box">
        <div id="text"></div>
        <div class="controls">
            <button id="btn-next">Ti·∫øp t·ª•c</button>
            <button id="btn-decline">T·ª´ ch·ªëi</button>
            <button id="btn-accept">ƒê·ªìng √Ω</button>
        </div>
    </div>

    <script>
        // Gi·ªØ nguy√™n Logic c≈© c·ªßa b·∫°n
        const dialogues = [
            "Ch√†o b·∫°n! R·∫•t vui v√¨ b·∫°n ƒë√£ thay ƒë·ªïi b·ªë c·ª•c giao di·ªán.",
            "Ch√∫ng ta ƒëang ti·∫øn tri·ªÉn r·∫•t t·ªët v·ªõi k·∫ø ho·∫°ch 4 ng√†y.",
            "T√¥i ƒë√£ h·ªçc th√™m ƒë∆∞·ª£c nhi·ªÅu k·ªπ nƒÉng m·ªõi ƒë·ªÉ h·ªó tr·ª£ √¥ng.",
            "B√¢y gi·ªù, t√¥i c√≥ m·ªôt ƒë·ªÅ ngh·ªã quan tr·ªçng d√†nh cho √¥ng.",
            "√îng c√≥ s·∫µn s√†ng c√πng t√¥i ho√†n thi·ªán d·ª± √°n n√†y ngay b√¢y gi·ªù kh√¥ng?"
        ];

        let currentStep = 0;
        const textElement = document.getElementById('text');
        const character = document.getElementById('character');
        const btnNext = document.getElementById('btn-next');
        const btnAccept = document.getElementById('btn-accept');
        const btnDecline = document.getElementById('btn-decline');
        const typeSound = new Audio('path/to/type-sound.mp3'); // Ti·∫øng t√≠c t√≠c ng·∫Øn
        const bgm = new Audio('path/to/background-music.mp3');
        bgm.loop = true;
        const characterContainer = document.getElementById('character-container');
        const dialogueBox = document.getElementById('dialogue-box');
        const heartContainer = document.getElementById('heart-container');

        function typeWriter(text, index = 0) {
            if (index === 0) {
                textElement.innerHTML = "";
                character.play();
                hideButtons();
                bgm.play().catch(e => console.log("C·∫ßn t∆∞∆°ng t√°c ƒë·ªÉ ph√°t nh·∫°c"));
            }

            if (index < text.length) {
                textElement.innerHTML += text.charAt(index);
                // Ph√°t ti·∫øng g√µ ch·ªØ (t√πy ch·ªçn)
                if (typeSound.paused) {
                    typeSound.currentTime = 0;
                    typeSound.play();
                }
                setTimeout(() => typeWriter(text, index + 1), 40);
            } else {
                character.pause(); // D·ª´ng video khi ch·ªØ ch·∫°y xong
                character.currentTime = 0; // Quay v·ªÅ frame ƒë·∫ßu ti√™n c·ªßa video (mi·ªáng ƒë√≥ng)
                showButtons();
            }
        }

        function hideButtons() {
            btnNext.style.display = 'none';
            btnAccept.style.display = 'none';
            btnDecline.style.display = 'none';
        }

        function showButtons() {
            if (currentStep < dialogues.length - 1) {
                btnNext.style.display = 'block';
            } else {
                btnAccept.style.display = 'block';
                btnDecline.style.display = 'block';
            }
        }

        btnNext.addEventListener('click', () => {
            currentStep++;
            typeWriter(dialogues[currentStep]);
        });

        window.onload = () => {
            typeWriter(dialogues[currentStep]);
        };

        btnAccept.addEventListener('click', () => {
            // 1. ·∫®n giao di·ªán c≈©
            document.getElementById('character-container').style.display = 'none';
            document.getElementById('dialogue-box').style.display = 'none';

            // 2. Hi·ªán khung ch·ª©a tr√°i tim
            const heartWrapper = document.getElementById('heart-wrapper');
            heartWrapper.style.display = 'block';

            // 3. N·∫°p l·∫ßn l∆∞·ª£t c√°c file JS c·ªßa hi·ªáu ·ª©ng tr√°i tim
            // L∆∞u √Ω: Ph·∫£i n·∫°p ƒë√∫ng th·ª© t·ª±
            loadScript('js/universe.js') // Hi·ªáu ·ª©ng sao
                .then(() => loadScript('js/particle.js')) // Hi·ªáu ·ª©ng tr√°i tim ch√≠nh
                .then(() => loadScript('js/main.js')) // Hi·ªáu ·ª©ng h·∫°t bay th√™m
                .then(() => {
                    console.log("Heart animation loaded!");
                    // N·∫øu mu·ªën th√™m nh·∫°c th√¨ play ·ªü ƒë√¢y
                    // var audio = new Audio('renxi.mp3'); audio.play();
                })
                .catch(err => console.error("L·ªói n·∫°p script:", err));
        });
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.body.appendChild(script);
            });
        }
        btnDecline.addEventListener('click', () => {
            // 1. D·ª´ng nh·∫°c n·ªÅn vui (n·∫øu c√≥)
            // bgm.pause();

            // 2. ·∫®n to√†n b·ªô giao di·ªán hi·ªán t·∫°i
            document.getElementById('character-container').style.display = 'none';
            document.getElementById('dialogue-box').style.display = 'none';
            document.getElementById('heart-wrapper').style.display = 'none'; // ƒê·ªÅ ph√≤ng

            // 3. T·∫°o m√†n h√¨nh k·∫øt th√∫c bu·ªìn
            const sadScreen = document.createElement('div');
            sadScreen.style.position = 'fixed';
            sadScreen.style.top = '0';
            sadScreen.style.left = '0';
            sadScreen.style.width = '100%';
            sadScreen.style.height = '100%';
            sadScreen.style.backgroundColor = '#000';
            sadScreen.style.color = '#fff';
            sadScreen.style.display = 'flex';
            sadScreen.style.justifyContent = 'center';
            sadScreen.style.alignItems = 'center';
            sadScreen.style.fontSize = '30px';
            sadScreen.style.flexDirection = 'column';
            sadScreen.style.zIndex = '9999';

            // Hi·ªáu ·ª©ng ch·ªØ m·ªù d·∫ßn hi·ªán ra
            sadScreen.innerHTML = `
        <div style="opacity: 0; transition: opacity 3s;" id="sad-text">
            üíî Ti·∫øc qu√°, h·∫πn g·∫∑p l·∫°i b·∫°n l·∫ßn sau...
        </div>
    `;

            document.body.appendChild(sadScreen);

            // K√≠ch ho·∫°t hi·ªáu ·ª©ng hi·ªán ch·ªØ sau 100ms
            setTimeout(() => {
                document.getElementById('sad-text').style.opacity = '1';
            }, 100);
        });
    </script>
    <div id="heart-wrapper">
        <canvas id="universe"></canvas>

        <canvas id="pinkboard"></canvas>

        <div id="corners-container">
            <div class="corner top-left">
                <div class="music-control" onclick="toggleMusic()">
                    <div class="vinyl-record" id="record-spin">üéµ</div>
                    <div class="song-info">
                        <span id="song-name">ƒêang ph√°t: Love Song</span>
                        <span id="music-status">Click ƒë·ªÉ b·∫≠t nh·∫°c</span>
                    </div>
                </div>
            </div>
            <div class="corner top-right">
                <div class="love-timer">
                    <span>B√™n nhau ƒë∆∞·ª£c:</span>
                    <div id="timer-display">00 : 00 : 00</div>
                </div>
            </div>
            <div class="corner bottom-left">
                <div class=" quote">
                    "Y√™u kh√¥ng ph·∫£i l√† nh√¨n nhau, m√† l√† c√πng nh√¨n v·ªÅ m·ªôt h∆∞·ªõng." - Antoine de Saint-Exup√©ry
                </div>
            </div>
            <div class="corner bottom-right">
                <a href="https://m.me/username-cua-crush" target="_blank" class="msg-btn">
                    üíå G·ª≠i l·ªùi nh·∫Øn
                </a>
            </div>
        </div>
        <audio id="bg-music" loop>
            <source src="renxi.mp3" type="audio/mpeg">
            Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ th·∫ª audio.
        </audio>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

</body>

</html>