<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Playfair+Display:ital,wght@1,600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    </link>
</head>

<body>
    <div class="bokeh"></div>
    <div class="bokeh"></div>
    <div class="bokeh"></div>
    <div id="character-container">
        <video id="character" muted loop>
            <source src="nhanvat_noi.mp4" type="video/mp4">
            Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ th·∫ª video.
        </video>
    </div>

    <div id="dialogue-box">
        <div id="text"></div>
        <div class="controls">
            <button id="btn-next">Ti·∫øp t·ª•c</button>
            <button id="btn-decline">T·ª´ ch·ªëi</button>
            <button id="btn-accept">ƒê·ªìng √Ω</button>
        </div>
    </div>

    <script>
        function createFloatingHeart() {
            const heart = document.createElement('div');
            heart.className = 'floating-heart';
            heart.innerHTML = '‚ù§';

            // V·ªã tr√≠ ngang ng·∫´u nhi√™n
            heart.style.left = Math.random() * 100 + 'vw';

            // K√≠ch th∆∞·ªõc ng·∫´u nhi√™n (t·∫°o chi·ªÅu s√¢u)
            const size = Math.random() * 15 + 10 + 'px';
            heart.style.fontSize = size;

            // Th·ªùi gian bay v√† ƒë·ªô m·ªù ng·∫´u nhi√™n
            const duration = Math.random() * 5 + 10 + 's';
            heart.style.animationDuration = duration;
            heart.style.opacity = Math.random() * 0.4 + 0.2;

            document.body.appendChild(heart);

            // X√≥a ƒë·ªÉ tr√°nh lag m√°y
            setTimeout(() => {
                heart.remove();
            }, parseFloat(duration) * 1000);
        }
        // Gi·ªØ nguy√™n Logic c≈© c·ªßa b·∫°n
        const dialogues = [
            "Ch√†o b·∫°n! R·∫•t vui v√¨ b·∫°n ƒë√£ thay ƒë·ªïi b·ªë c·ª•c giao di·ªán.",
            "Ch√∫ng ta ƒëang ti·∫øn tri·ªÉn r·∫•t t·ªët v·ªõi k·∫ø ho·∫°ch 4 ng√†y.",
            "T√¥i ƒë√£ h·ªçc th√™m ƒë∆∞·ª£c nhi·ªÅu k·ªπ nƒÉng m·ªõi ƒë·ªÉ h·ªó tr·ª£ √¥ng.",
            "B√¢y gi·ªù, t√¥i c√≥ m·ªôt ƒë·ªÅ ngh·ªã quan tr·ªçng d√†nh cho √¥ng.",
            "√îng c√≥ s·∫µn s√†ng c√πng t√¥i ho√†n thi·ªán d·ª± √°n n√†y ngay b√¢y gi·ªù kh√¥ng?"
        ];

        let currentStep = 0;
        const textElement = document.getElementById('text');
        const character = document.getElementById('character');
        const btnNext = document.getElementById('btn-next');
        const btnAccept = document.getElementById('btn-accept');
        const btnDecline = document.getElementById('btn-decline');
        const typeSound = new Audio('path/to/type-sound.mp3'); // Ti·∫øng t√≠c t√≠c ng·∫Øn
        const bgm = new Audio('path/to/background-music.mp3');
        bgm.loop = true;
        const characterContainer = document.getElementById('character-container');
        const dialogueBox = document.getElementById('dialogue-box');
        const heartContainer = document.getElementById('heart-container');

        function typeWriter(text, index = 0) {
            if (index === 0) {
                textElement.innerHTML = "";
                character.play();
                hideButtons();
                bgm.play().catch(e => console.log("C·∫ßn t∆∞∆°ng t√°c ƒë·ªÉ ph√°t nh·∫°c"));
            }

            if (index < text.length) {
                textElement.innerHTML += text.charAt(index);
                // Ph√°t ti·∫øng g√µ ch·ªØ (t√πy ch·ªçn)
                if (typeSound.paused) {
                    typeSound.currentTime = 0;
                    typeSound.play();
                }
                setTimeout(() => typeWriter(text, index + 1), 40);
            } else {
                character.pause(); // D·ª´ng video khi ch·ªØ ch·∫°y xong
                character.currentTime = 0; // Quay v·ªÅ frame ƒë·∫ßu ti√™n c·ªßa video (mi·ªáng ƒë√≥ng)
                showButtons();
            }
        }

        function hideButtons() {
            btnNext.style.display = 'none';
            btnAccept.style.display = 'none';
            btnDecline.style.display = 'none';
        }

        function showButtons() {
            if (currentStep < dialogues.length - 1) {
                btnNext.style.display = 'block';
            } else {
                btnAccept.style.display = 'block';
                btnDecline.style.display = 'block';
            }
        }

        btnNext.addEventListener('click', () => {
            currentStep++;
            typeWriter(dialogues[currentStep]);
        });

        window.onload = () => {
            typeWriter(dialogues[currentStep]);
            setInterval(createFloatingHeart, 500);
        };

        btnAccept.addEventListener('click', () => {

            const audio = document.getElementById('bg-music');
            audio.play().catch(error => {
                console.log("L·ªói autoplay (n·∫øu c√≥):", error);
            });
            // ·∫®n giao di·ªán c≈©
            document.getElementById('character-container').style.display = 'none';
            document.getElementById('dialogue-box').style.display = 'none';

            // Hi·ªán khung ch·ª©a tr√°i tim
            const heartWrapper = document.getElementById('heart-wrapper');
            heartWrapper.style.display = 'block';

            // N·∫°p l·∫ßn l∆∞·ª£t c√°c file JS c·ªßa hi·ªáu ·ª©ng tr√°i tim
            // L∆∞u √Ω: Ph·∫£i n·∫°p ƒë√∫ng th·ª© t·ª±
            loadScript('js/universe.js') // Hi·ªáu ·ª©ng sao
                .then(() => loadScript('js/particle.js')) // Hi·ªáu ·ª©ng tr√°i tim ch√≠nh
                .then(() => loadScript('js/main.js')) // Hi·ªáu ·ª©ng h·∫°t bay th√™m
                .then(() => {
                    console.log("Heart animation loaded!");
                    // N·∫øu mu·ªën th√™m nh·∫°c th√¨ play ·ªü ƒë√¢y
                    // var audio = new Audio('renxi.mp3'); audio.play();
                })
                .catch(err => console.error("L·ªói n·∫°p script:", err));
        });
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.body.appendChild(script);
            });
        }

        function moveButton() {
            // 1. Thi·∫øt l·∫≠p kho·∫£ng c√°ch an to√†n (kh√¥ng cho n√∫t d√≠nh s√°t m√©p m√†n h√¨nh)
            const margin = 50;

            // 2. L·∫•y k√≠ch th∆∞·ªõc th·ª±c t·∫ø c·ªßa m√†n h√¨nh v√† c·ªßa c√°i n√∫t
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            const buttonWidth = btnDecline.offsetWidth;
            const buttonHeight = btnDecline.offsetHeight;

            // 3. T√≠nh to√°n ph·∫°m vi t·ªëi ƒëa m√† n√∫t c√≥ th·ªÉ nh·∫£y t·ªõi
            // (Chi·ªÅu r·ªông m√†n h√¨nh - chi·ªÅu r·ªông n√∫t - kho·∫£ng c√°ch an to√†n)
            const maxX = screenWidth - buttonWidth - margin;
            const maxY = screenHeight - buttonHeight - margin;

            // 4. Sinh t·ªça ƒë·ªô ng·∫´u nhi√™n trong ph·∫°m vi cho ph√©p
            // Math.max(margin, ...) ƒë·ªÉ ƒë·∫£m b·∫£o n√∫t kh√¥ng nh·∫£y v·ªÅ t·ªça ƒë·ªô < margin (m√©p tr√°i/tr√™n)
            const randomX = Math.max(margin, Math.floor(Math.random() * maxX));
            const randomY = Math.max(margin, Math.floor(Math.random() * maxY));

            // 5. √Åp d·ª•ng v·ªã tr√≠ m·ªõi
            btnDecline.style.position = 'fixed'; // D√πng fixed ƒë·ªÉ n√≥ nh·∫£y ƒë√® l√™n m·ªçi th·ª©
            btnDecline.style.left = randomX + 'px';
            btnDecline.style.top = randomY + 'px';
            btnDecline.style.transition = 'all 0.2s ease'; // Th√™m ch√∫t hi·ªáu ·ª©ng tr∆∞·ª£t cho m∆∞·ª£t
        }

        // K√≠ch ho·∫°t khi di chu·ªôt qua (D√†nh cho m√°y t√≠nh)
        btnDecline.addEventListener('mouseover', moveButton);

        // K√≠ch ho·∫°t khi ch·∫°m v√†o (D√†nh cho ƒëi·ªán tho·∫°i)
        btnDecline.addEventListener('touchstart', (e) => {
            e.preventDefault(); // NgƒÉn ch·∫∑n h√†nh ƒë·ªông click m·∫∑c ƒë·ªãnh khi ch·∫°m
            moveButton();
        });
        btnDecline.addEventListener('click', () => {
            // 1. D·ª´ng nh·∫°c n·ªÅn vui (n·∫øu c√≥)
            // bgm.pause();

            // 2. ·∫®n to√†n b·ªô giao di·ªán hi·ªán t·∫°i
            document.getElementById('character-container').style.display = 'none';
            document.getElementById('dialogue-box').style.display = 'none';
            document.getElementById('heart-wrapper').style.display = 'none'; // ƒê·ªÅ ph√≤ng

            // 3. T·∫°o m√†n h√¨nh k·∫øt th√∫c bu·ªìn
            const sadScreen = document.createElement('div');
            sadScreen.style.position = 'fixed';
            sadScreen.style.top = '0';
            sadScreen.style.left = '0';
            sadScreen.style.width = '100%';
            sadScreen.style.height = '100%';
            sadScreen.style.backgroundColor = '#000';
            sadScreen.style.color = '#fff';
            sadScreen.style.display = 'flex';
            sadScreen.style.justifyContent = 'center';
            sadScreen.style.alignItems = 'center';
            sadScreen.style.fontSize = '30px';
            sadScreen.style.flexDirection = 'column';
            sadScreen.style.zIndex = '9999';

            // Hi·ªáu ·ª©ng ch·ªØ m·ªù d·∫ßn hi·ªán ra
            sadScreen.innerHTML = `
        <div style="opacity: 0; transition: opacity 3s;" id="sad-text">
            üíî Ti·∫øc qu√°, h·∫πn g·∫∑p l·∫°i b·∫°n l·∫ßn sau...
        </div>
    `;

            document.body.appendChild(sadScreen);

            // K√≠ch ho·∫°t hi·ªáu ·ª©ng hi·ªán ch·ªØ sau 100ms
            setTimeout(() => {
                document.getElementById('sad-text').style.opacity = '1';
            }, 100);
        });
    </script>
    <div id="heart-wrapper">
        <canvas id="universe"></canvas>

        <canvas id="pinkboard"></canvas>

        <div id="corners-container">
            <div class="corner top-left">
                <div class="music-control" onclick="toggleMusic()">
                    <div class="vinyl-record" id="record-spin">üéµ</div>
                    <div class="song-info">
                        <span id="song-name">ƒêang ph√°t: Love Song</span>
                        <span id="music-status">Click ƒë·ªÉ b·∫≠t nh·∫°c</span>
                    </div>
                </div>
            </div>
            <div class="corner top-right">
                <div class="love-timer">
                    <span>B√™n nhau ƒë∆∞·ª£c:</span>
                    <div id="timer-display">00 : 00 : 00</div>
                </div>
            </div>
            <div class="corner bottom-left">
                <div class=" quote">
                    "Y√™u kh√¥ng ph·∫£i l√† nh√¨n nhau, m√† l√† c√πng nh√¨n v·ªÅ m·ªôt h∆∞·ªõng." - Antoine de Saint-Exup√©ry
                </div>
            </div>
            <div class="corner bottom-right">
                <a href="https://m.me/hoang.khang.544656" target="_blank" class="msg-btn">
                    üíå G·ª≠i l·ªùi nh·∫Øn
                </a>
            </div>
        </div>
        <audio id="bg-music" loop>
            <source src="Swim.mp3" type="audio/mp3">
            Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ th·∫ª audio.
        </audio>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

</body>

</html>